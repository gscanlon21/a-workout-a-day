@model Web.Views.Index.CreateViewModel
@inject IOptions<CaptchaSettings> CaptchaSettings
@using Core.Models.Exercise
@using Web.Code.Extensions;
@using Web.Controllers.Index

@{
    ViewData[ViewData_Blank.Title] = "Consistent Fitness";
    ViewData[ViewData_Blank.Description] = "A personalizable workout routine newsletter.";
    ViewData[ViewData_Blank.Canonical] = _siteSettings.Value.WebUri.AbsoluteUri;
}

<div class="row gy-2 mb-2 mt-1 justify-content-between align-items-end">
    <div class="col-auto mb-3">
        <h1 class="primary-heading">Consistent fitness starts here</h1>
        <h2 class="secondary-heading">A personalized workout routine delivered to your inbox daily</h2>
    </div>
    <partial name="_ValidationMessagePartial" model='new ValidationMessagePartialModel()' />
</div>

<div class="row gy-4">
    <div class="col-12 col-lg-5 col-xl-4">
        <div class="alert alert-secondary mb-0">
            @if (Model.WasSubscribed == true)
            {
                <div class="d-flex justify-content-center logo">
                    @Html.Raw(File.ReadAllText(System.IO.Path.Combine(_webHostEnvironment.WebRootPath, "images/logo-success.svg")))
                </div>

                <h5 class="text-center">Thank you for signing up!</h5>
                <h6 class="text-center mb-3">Get ready! Your first workout is on its way.</h6>
                <p class="text-center">Click <a href="@Url.ActionLink(nameof(UserController.Edit), UserController.Name, new { Model.UserCreateViewModel.Email, Model.UserCreateViewModel.Token }, Uri.UriSchemeHttps)">here</a> to personalize your routine.</p>
            } 
            else if (Model.WasUnsubscribed == true)
            {
                <div class="d-flex justify-content-center logo">
                    @Html.Raw(File.ReadAllText(System.IO.Path.Combine(_webHostEnvironment.WebRootPath, "images/logo-success.svg")))
                </div>

                <h5 class="text-center">We're sorry to see you go!</h5>
                <h6 class="text-center mb-3">All of your data has been permanently deleted.</h6>
                <p class="text-center mb-3">Please contact us at <a class="allow-demo" href="mailto:goodbye@@@_siteSettings.Value.Domain">goodbye@@@_siteSettings.Value.Domain</a> and let us know how we can improve.</p>
                <p class="text-center"><a class="allow-demo" href="@Url.ActionLink(nameof(IndexController.Index), IndexController.Name, protocol: Uri.UriSchemeHttps)">Click here to resubscribe.</a></p>
            }
            else 
            {
                <div class="mb-4">
                    <div class="d-flex justify-content-center logo">
                        @if (Model.WasSubscribed == false || Model.WasUnsubscribed == false)
                        {
                            @Html.Raw(File.ReadAllText(System.IO.Path.Combine(_webHostEnvironment.WebRootPath, "images/logo-danger.svg")))
                        }
                        else if (TempData[TempData_User.SuccessMessage] != null)
                        {
                            @Html.Raw(File.ReadAllText(System.IO.Path.Combine(_webHostEnvironment.WebRootPath, "images/logo-success.svg")))
                        }
                        else
                        {
                            @Html.Raw(File.ReadAllText(System.IO.Path.Combine(_webHostEnvironment.WebRootPath, "images/logo.svg")))
                        }
                    </div>

                    @if (Model.WasUnsubscribed == false)
                    {
                        <h5 class="text-center">An unknown error occurred.</h5>
                        <h6 class="text-center">Please contact us at <a class="allow-demo" href="mailto:help@@@_siteSettings.Value.Domain">help@@@_siteSettings.Value.Domain</a> to have your account deleted.</h6>
                    }
                    else
                    {
                        // If Model.WasSubscribed == false, just show the validation messages in the form. No need for a 'something went wrong' message.
                        <h6 class="text-center">Subscribe to our home workout routine newsletter and take the guesswork out of fitness!</h6>
                    }
                </div>

                <h6 class="mt-4 mb-1">Sign up</h6>
                <form asp-controller="@IndexController.Name" asp-action="@nameof(IndexController.Create)" method="post" class="alert alert-light shadow">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="mb-3">
                        <label asp-for="UserCreateViewModel.Email" class="control-label" aria-describedby="email-help">@Html.DisplayNameFor(_ => Model.UserCreateViewModel.Email)</label>
                        <input asp-for="UserCreateViewModel.Email" class="form-control allow-demo" />
                        <span asp-validation-for="UserCreateViewModel.Email" class="text-danger word-break--break-word"></span>
                        <div id="email-help" class="form-text">@Html.DisplayDescriptionFor(_ => Model.UserCreateViewModel.Email)</div>
                    </div>
                    <div class="form-check mb-3">
                        <div>
                            <span><label asp-for="UserCreateViewModel.IsNewToFitness" class="control-label">@Html.DisplayNameFor(_ => Model.UserCreateViewModel.IsNewToFitness)</label></span>
                            <input class="form-check-input allow-demo" asp-for="UserCreateViewModel.IsNewToFitness" aria-describedby="fitness-help" />
                        </div>
                        <span asp-validation-for="UserCreateViewModel.IsNewToFitness" class="text-danger"></span>
                        <div id="fitness-help" class="form-text">@Html.DisplayDescriptionFor(_ => Model.UserCreateViewModel.IsNewToFitness)</div>
                    </div>
                    <div class="form-check mb-3">
                        <div>
                            <span><label asp-for="UserCreateViewModel.AcceptedTerms" class="control-label">I agree to the</label> <a class="allow-demo" asp-area="" asp-page="/Terms">Terms of Use</a></span>
                            <input class="form-check-input allow-demo" asp-for="UserCreateViewModel.AcceptedTerms" aria-describedby="terms-help" />
                        </div>
                        <span asp-validation-for="UserCreateViewModel.AcceptedTerms" class="text-danger"></span>
                        <div id="terms-help" class="form-text">@Html.DisplayDescriptionFor(_ => Model.UserCreateViewModel.AcceptedTerms)</div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex">
                            <div class="form-check-inline order-2">
                                <input checked class="form-check-input allow-demo" id="IExistNo" name="@Html.NameFor(_ => Model.UserCreateViewModel.IExist)" type="radio" value="false" aria-describedby="bot-help" />
                                <span><label for="IExistNo" class="control-label">I'm a bot</label></span>
                            </div>
                            <div class="form-check-inline order-1">
                                <input class="form-check-input allow-demo" id="IExistYes" name="@Html.NameFor(_ => Model.UserCreateViewModel.IExist)" type="radio" value="true" aria-describedby="bot-help" />
                                <span><label for="IExistYes" class="control-label">I'm a human</label></span>
                            </div>
                        </div>
                        <span asp-validation-for="UserCreateViewModel.IExist" class="text-danger"></span>
                        <div id="bot-help" class="form-text">@Html.DisplayDescriptionFor(_ => Model.UserCreateViewModel.IExist)</div>
                    </div>
                    <div class="mb-3">
                        <div class="frc-captcha" data-sitekey="@CaptchaSettings.Value.SiteKey"></div>
                    </div>
                    <div>
                        <input type="submit" value="Send Me Workouts" class="btn btn-primary btn-caps font-weight--semibold w-100 allow-demo" aria-describedby="join-help" />
                        <div id="join-help" class="form-text">Update your preferences or unsubscribe at any time.</div>
                    </div>
                </form>

                <details class="mb-1" @(Model.WasSubscribed == false ? "open='open'" : "")>
                    <summary class="mt-4 mb-1 h6">Login</summary>

                    <form asp-controller="@IndexController.Name" asp-action="@nameof(IndexController.Login)" method="post" class="alert alert-light shadow">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                        <div class="mb-3">
                            <label asp-for="UserLoginViewModel.Email" class="control-label" aria-describedby="email2-help">@Html.DisplayNameFor(_ => Model.UserLoginViewModel.Email)</label>
                            <input asp-for="UserLoginViewModel.Email" class="form-control allow-demo" />
                            <span asp-validation-for="UserLoginViewModel.Email" class="text-danger word-break--break-word"></span>
                            <div id="email2-help" class="form-text">@Html.DisplayDescriptionFor(_ => Model.UserLoginViewModel.Email)</div>
                        </div>
                        <div class="mb-3">
                            <div>
                                <div class="form-check-inline">
                                    <input checked class="form-check-input allow-demo" id="IExistNo2" name="@Html.NameFor(_ => Model.UserLoginViewModel.IExist)" type="radio" value="false" aria-describedby="bot2-help" />
                                    <span><label for="IExistNo2" class="control-label">I'm a bot</label></span>
                                </div>
                                <div class="form-check-inline">
                                    <input class="form-check-input allow-demo" id="IExistYes2" name="@Html.NameFor(_ => Model.UserLoginViewModel.IExist)" type="radio" value="true" aria-describedby="bot2-help" />
                                    <span><label for="IExistYes2" class="control-label">I'm a human</label></span>
                                </div>
                            </div>
                            <span asp-validation-for="UserLoginViewModel.IExist" class="text-danger"></span>
                            <div id="bot2-help" class="form-text">@Html.DisplayDescriptionFor(_ => Model.UserLoginViewModel.IExist)</div>
                        </div>
                        <div class="mb-3">
                            <div class="frc-captcha" data-sitekey="@CaptchaSettings.Value.SiteKey"></div>
                        </div>
                        <div>
                            <input type="submit" value="Send Me a Login Link" class="btn btn-outline-primary btn-caps font-weight--semibold w-100 allow-demo" aria-describedby="join2-help" />
                            <div id="join2-help" class="form-text">Use this to resend your account confirmation email.</div>
                        </div>
                    </form>
                </details>
            }
        </div>
    </div>

    <aside class="col-auto flex-grow-1 width--min-content">
        <h6 class="mb-1">Demo<small class="font-weight--normal font-size--small">&nbsp;- some features are altered or disabled.</small></h6>

        <div class="alert p-0 mb-0 shadow border d-flex flex-column" style="background:url('@Url.AbsoluteContent($"~/images/loader.svg")') center center no-repeat;">
            <noscript><a target="_blank" href="@Url.ActionLink(nameof(NewsletterController.Newsletter), NewsletterController.Name, protocol: Uri.UriSchemeHttps)">Open the demo in a new tab.</a></noscript>
            <!-- View is used in emails. Remove page styling by rendering it in an iframe -->
            <iframe class="col-12 gx-0 w-100 demo-frame"
                    title="Demo - @_siteSettings.Value.Name"
                    onload="this.style.visibility = 'visible';this.parentElement.style.background = null;"
                    src="@Url.ActionLink(nameof(NewsletterController.Newsletter), NewsletterController.Name, new { HideFooter = true }, Uri.UriSchemeHttps)"></iframe>
        </div>
    </aside>
</div>

<div class="row gy-3 mt-3">
    <div class="col-12">
        <h3 class="alert alert-info callout mb-0">
            Features
        </h3>
    </div>

    @* Wrapper div since the Edit component renders a ".row" on the root element. *@
    <div class="col-12">
        @await Component.InvokeAsync(EditViewComponent.Name)
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" model='new ValidationScriptsPartialViewModel() { IsDemoUser = true }' />
}
